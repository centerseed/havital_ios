# Apple Watch App 測試指南

> 完整的 Paceriz Watch app 測試流程和方法

---

## 📋 測試準備

### 選項 1: 模擬器測試（基礎 UI 測試）

**優點**：
- ✅ 快速啟動，無需實體設備
- ✅ 可以測試 UI 佈局和導航
- ✅ 適合快速迭代開發

**限制**：
- ❌ 無法測試 HealthKit（心率、GPS）
- ❌ 無法測試 WatchConnectivity（需要配對的 iPhone）
- ❌ 無法測試提示音和震動
- ❌ 無法測試真實的訓練場景

**適合測試**：
- UI 佈局是否正確
- 課表列表顯示
- 課表詳情頁面
- 顏色和字體

---

### 選項 2: 真機測試（完整功能測試）⭐ 推薦

**需要設備**：
- Apple Watch Series 4 或更新（支援 watchOS 9.0+）
- iPhone 8 或更新（用於配對）
- 兩個設備都需要登入相同的 Apple ID

**優點**：
- ✅ 可以測試所有功能
- ✅ 真實的訓練體驗
- ✅ HealthKit 數據採集
- ✅ GPS 追蹤
- ✅ 提示音和震動

---

## 🚀 快速開始測試

### Step 1: 準備測試環境

#### 1.1 確保設備配對

1. 打開 iPhone 上的 **Watch** app
2. 確認 Apple Watch 已配對並處於「已配對」狀態
3. 檢查 watchOS 版本（需要 9.0+）

#### 1.2 確保 Xcode 配置完成

按照 `APPLE_WATCH_SETUP_GUIDE.md` 完成：
- ✅ watchOS target 已創建
- ✅ App Group 已配置
- ✅ HealthKit 和 Location 權限已添加
- ✅ 所有文件已添加到正確的 target

---

### Step 2: 模擬器測試（可選）

#### 2.1 選擇模擬器

1. 在 Xcode 中，選擇 Scheme: **PacerizWatch**
2. 選擇目標設備：
   - **Apple Watch Series 9 (45mm)** - 推薦
   - 或 **Apple Watch Series 8 (41mm)**
   - 或 **Apple Watch Ultra (49mm)**

3. 點擊 **Run** (⌘R)

#### 2.2 模擬器測試清單

**可以測試的功能**：
- [ ] App 成功啟動
- [ ] 顯示「尚無課表」提示（因為沒有 WatchConnectivity）
- [ ] UI 顏色和字體正確
- [ ] 導航流程正常

**如何模擬數據**：

在 `WatchDataManager.swift` 中臨時添加測試數據：

```swift
private override init() {
    super.init()

    // ⚠️ 測試用：添加假數據
    #if DEBUG
    loadMockData()
    #endif
}

private func loadMockData() {
    // 創建測試課表
    let mockDay = WatchTrainingDay(
        id: "test-1",
        dayIndex: "2025-11-17",
        dayTarget: "輕鬆跑 8 公里",
        trainingType: "easy",
        trainingDetails: WatchTrainingDetails(
            description: "保持輕鬆配速",
            distanceKm: 8.0,
            totalDistanceKm: nil,
            timeMinutes: 44,
            pace: "5:30",
            work: nil,
            recovery: nil,
            repeats: nil,
            heartRateRange: WatchHeartRateRange(min: 120, max: 145),
            segments: nil
        )
    )

    let mockPlan = WatchWeeklyPlan(
        id: "test-plan",
        weekOfPlan: 3,
        totalWeeks: 12,
        totalDistance: 50.0,
        days: [mockDay]
    )

    self.weeklyPlan = mockPlan
}
```

---

### Step 3: 真機測試（完整流程）⭐

#### 3.1 安裝到 Apple Watch

1. 確保 Apple Watch 已解鎖並充電
2. 確保與 Mac 在同一 Wi-Fi 網路
3. 在 Xcode 中：
   - 選擇 Scheme: **PacerizWatch**
   - 選擇目標設備: **你的 Apple Watch 名稱**
   - 點擊 **Run** (⌘R)

**首次安裝注意事項**：
- ⏱️ 首次安裝可能需要 2-3 分鐘
- 📱 確保 iPhone 螢幕保持開啟
- 🔋 確保 Apple Watch 電量 > 30%

#### 3.2 基礎功能測試（第一次運行）

**測試 1: App 啟動**
- [ ] App 圖標出現在 Apple Watch 主畫面
- [ ] 點擊圖標，app 成功啟動
- [ ] 顯示「尚無課表」畫面（因為還沒同步）

**測試 2: 權限請求**
- [ ] 嘗試點擊「手動同步」（會失敗，因為 iPhone app 還沒啟動）
- [ ] 觀察是否有錯誤提示

---

#### 3.3 與 iOS App 集成測試

**Step 3.3.1: 在 iOS App 中啟用 WatchConnectivity**

在 `Havital/HavitalApp.swift` 中添加：

```swift
import SwiftUI

@main
struct HavitalApp: App {
    @StateObject private var watchService = WatchConnectivityService.shared

    var body: some Scene {
        WindowGroup {
            ContentView()
                .environmentObject(watchService)
                .task {
                    // App 啟動時自動同步
                    if watchService.isWatchPaired && watchService.isWatchAppInstalled {
                        await watchService.syncWeeklyPlan()
                    }
                }
        }
    }
}
```

**Step 3.3.2: 在 TrainingPlanManager 中觸發同步**

在 `TrainingPlanManager.swift` 的課表生成/更新處：

```swift
func generateWeeklyPlan() async {
    // ... 現有的課表生成邏輯 ...

    // 生成成功後同步到 Watch
    Task {
        await WatchConnectivityService.shared.syncWeeklyPlan()
    }
}
```

**Step 3.3.3: 執行同步測試**

1. **在 iPhone 上運行 Paceriz app**
   - 確保已登入並有訓練計劃
   - 檢查 Xcode Console，應該看到：
     ```
     ✅ WatchConnectivity: 激活成功
     ✅ WatchConnectivity: 同步成功
     ```

2. **在 Apple Watch 上查看**
   - 打開 Paceriz Watch app
   - 下拉刷新（或重新啟動 app）
   - 應該看到課表列表

3. **驗證同步數據**
   - [ ] 週數正確顯示（如「第 3/12 週」）
   - [ ] 今天的訓練高亮顯示
   - [ ] 訓練類型圓點顏色正確
   - [ ] 距離和配速顯示正確

---

#### 3.4 課表詳情測試

**測試不同訓練類型**：

**3.4.1 簡單訓練（輕鬆跑）**
- [ ] 點擊輕鬆跑課表
- [ ] 顯示目標距離、時間
- [ ] 顯示心率區間（如 120-145 bpm）
- [ ] 顯示訓練說明
- [ ] 「開始訓練」按鈕可見

**3.4.2 間歇訓練**
- [ ] 點擊間歇跑課表
- [ ] 顯示組數（如「6 組」）
- [ ] 顯示工作段詳情（距離、配速）
- [ ] 顯示恢復段詳情
- [ ] 總距離正確計算

**3.4.3 組合跑**
- [ ] 點擊組合跑課表
- [ ] 所有階段都顯示（可滾動）
- [ ] 每個階段顯示距離和配速
- [ ] 總距離正確

---

#### 3.5 訓練追蹤測試（核心功能）⭐⭐⭐

**準備工作**：
- 🏃 建議在戶外進行測試（GPS 信號較好）
- 🔋 確保 Apple Watch 電量充足（> 50%）
- ⌚ 戴好 Apple Watch，確保心率感測器貼合手腕

**測試 3.5.1: 開始訓練**

1. 選擇一個訓練（建議先測試簡單的輕鬆跑）
2. 點擊「開始訓練」
3. 授予 HealthKit 權限：
   - [ ] 心率
   - [ ] 活動能量
   - [ ] 距離
4. 授予 Location 權限：
   - [ ] 「使用 App 時允許」

**首次啟動檢查**：
- [ ] 訓練頁面顯示
- [ ] 大數字顯示當前心率（應該開始跳動）
- [ ] GPS 開始定位（可能需要 10-30 秒）
- [ ] 距離開始累計
- [ ] 配速開始計算（開始跑步後）

**測試 3.5.2: 心率模式（輕鬆跑）**

開始慢跑，觀察：
- [ ] 當前心率實時更新（每秒）
- [ ] 心率區間指示器顯示（Z1-Z5）
- [ ] 當前在哪個區間（應該有綠色圓點和名稱）
- [ ] 區間指示條上的圓點移動
- [ ] 目標區間數值正確（如 120-145）

**測試心率超出範圍**：
1. 加速跑步，讓心率超過目標上限
   - [ ] 指示器延伸到當前值
   - [ ] 顯示「⚠️ 心率過高」
   - [ ] 圓點在目標區間右側

2. 慢下來，讓心率回到區間內
   - [ ] 顯示「✅ 區間內」
   - [ ] 圓點回到目標區間中間

**測試 3.5.3: 配速模式（節奏跑/閾值跑）**

選擇一個節奏跑或閾值跑訓練：
- [ ] 大數字顯示當前配速（如 4'32"/km）
- [ ] 目標配速顯示（如「目標 4'30"/km」）
- [ ] 配速區間顯示（慢的在左，快的在右）
- [ ] 區間數值正確（目標 ± 20 秒）

**測試配速區間延伸**：
1. 跑快一點（配速 < 目標 - 20秒）
   - [ ] 指示器延伸到右側
   - [ ] 顯示「⚠️ 配速過快」

2. 跑慢一點（配速 > 目標 + 20秒）
   - [ ] 指示器延伸到左側
   - [ ] 顯示「⚠️ 配速過慢」

3. 保持目標配速
   - [ ] 顯示「✅ 配速理想」

**測試 3.5.4: 間歇訓練分段追蹤** ⭐ 重點

選擇間歇跑訓練（如 6×1000m）：

**工作段測試**：
1. 開始訓練後進入第一組工作段
   - [ ] 顯示「🔴 工作段 1/6」
   - [ ] 顯示當前配速
   - [ ] 顯示目標配速（如 4'00"/km）
   - [ ] 顯示剩餘距離（如「剩餘 850m」）
   - [ ] 顯示下一段信息（如「下一段: 恢復跑 400m」）

2. 跑到剩餘約 50-100m 時
   - [ ] **聽到提示音**（5 秒倒數警告）
   - [ ] **感受到震動**
   - [ ] 剩餘距離繼續減少

3. 完成 1000m 後
   - [ ] **聽到完成提示音**（不同於警告音）
   - [ ] **感受到震動**（2 次）
   - [ ] 自動切換到恢復段

**恢復段測試（慢跑）**：
- [ ] 顯示「🟢 恢復段 1/6」
- [ ] 配速變更為恢復跑配速（如 6'00"/km）
- [ ] 顯示恢復段距離（如 400m）
- [ ] 完成後自動進入第 2 組工作段

**恢復段測試（全休）**：
如果課表設定為全休：
- [ ] 顯示「⏸️ 全休 1/6」
- [ ] 顯示剩餘時間倒數（如「1'25"」）
- [ ] 顯示目標休息時間（如「目標 2'00" 休息」）
- [ ] 顯示當前心率（正在恢復）
- [ ] 時間到後自動進入下一組

**完成所有組數**：
- [ ] 完成第 6 組後
- [ ] **聽到完成音**（歡快的）
- [ ] **感受到 3 次震動**

**測試 3.5.5: 組合跑階段追蹤**

選擇組合跑訓練（如熱身 + 節奏跑 + 衝刺 + 緩和）：

1. 階段 1（熱身）
   - [ ] 顯示「階段 1/4: 熱身」
   - [ ] 顯示目標配速（如 6'00"/km）
   - [ ] 顯示本階段剩餘距離（如「本階段剩餘 1.2km」）
   - [ ] 顯示下一段（如「下一段: 節奏跑 5.0km 4'30"/km」）

2. 切換到階段 2
   - [ ] **提示音 + 震動**
   - [ ] 顯示「階段 2/4: 節奏跑」
   - [ ] 配速目標更新

3. 後續階段
   - [ ] 每個階段切換都有提示
   - [ ] 最後階段顯示「最後一段」

**測試 3.5.6: 次要指標**

在訓練中檢查底部的次要指標：
- [ ] 距離實時更新（精確到小數點）
- [ ] 時間實時更新（MM:SS 格式）
- [ ] 卡路里實時累計

**測試 3.5.7: 訓練控制**

**暫停測試**：
1. 點擊暫停按鈕
   - [ ] 圖標變為播放圖標
   - [ ] 時間停止累計
   - [ ] GPS 停止更新
   - [ ] 心率繼續顯示（但不記錄）

2. 點擊繼續
   - [ ] 恢復訓練
   - [ ] 時間繼續累計
   - [ ] GPS 恢復

**結束測試**：
1. 點擊「X」結束按鈕
   - [ ] 顯示確認對話框「結束訓練？」
   - [ ] 有「結束並保存」和「取消」選項

2. 選擇「結束並保存」
   - [ ] 返回課表列表
   - [ ] 訓練數據保存到 HealthKit

---

#### 3.6 數據驗證測試

**在 Apple Watch 健康 app 中檢查**：
1. 打開 Watch 上的「健康」app
2. 進入「體能訓練」
3. 查看剛才的訓練記錄
   - [ ] 訓練類型：跑步
   - [ ] 距離正確
   - [ ] 時長正確
   - [ ] 心率數據存在

**在 iPhone 健康 app 中檢查**：
1. 打開 iPhone 上的「健康」app
2. 進入「摘要」→「體能訓練」
3. 查看訓練記錄
   - [ ] 訓練已同步
   - [ ] GPS 地圖顯示
   - [ ] 心率圖表顯示
   - [ ] 配速圖表顯示

**在 Paceriz iOS app 中檢查**（如果已實現自動讀取）：
- [ ] 訓練記錄出現在 workout 列表
- [ ] 數據上傳到後端
- [ ] 與課表關聯正確

---

## 🐛 常見問題排查

### 問題 1: App 無法安裝到 Apple Watch

**症狀**: Xcode 顯示「無法安裝」或「設備不可用」

**解決方案**:
1. 確保 Apple Watch 已解鎖
2. 確保 Watch 和 Mac 在同一 Wi-Fi
3. 在 Watch 上: 設定 → 一般 → 啟用開發者模式
4. 重新配對 Watch（最後手段）

---

### 問題 2: HealthKit 權限被拒絕

**症狀**: 訓練開始後心率一直顯示 0

**解決方案**:
1. 在 Watch 上: 設定 → 隱私權 → 健康 → Paceriz
2. 確保「心率」已啟用
3. 刪除 app 重新安裝
4. 檢查 `Info.plist` 中的權限描述

---

### 問題 3: GPS 無法定位

**症狀**: 距離一直是 0，或增長很慢

**解決方案**:
1. 確保在戶外（室內 GPS 信號極弱）
2. 等待 GPS 冷啟動（首次可能需要 30-60 秒）
3. 檢查 Location 權限已授予
4. 嘗試移動到空曠區域
5. 查看 Xcode Console 是否有 GPS 錯誤

---

### 問題 4: WatchConnectivity 無法同步

**症狀**: Watch app 顯示「尚無課表」，無法同步

**解決方案**:
1. 確保 iPhone app 正在運行（前台或背景）
2. 確保兩個設備都在同一 iCloud 帳號
3. 檢查 App Group 配置是否一致
4. 查看 Xcode Console 日誌:
   ```
   ❌ WatchConnectivity: Apple Watch 未配對
   ```

**測試 WatchConnectivity**:
```swift
// 在 iPhone app 中添加測試按鈕
Button("測試同步到 Watch") {
    Task {
        await WatchConnectivityService.shared.syncWeeklyPlan()
    }
}
```

---

### 問題 5: 提示音沒有聲音

**症狀**: 5 秒倒數和段落完成沒有提示音

**解決方案**:
1. 確保 Watch 沒有靜音
2. 調高音量: 設定 → 聲音與觸覺回饋 → 音量
3. 檢查「靜音模式」是否關閉
4. 檢查「勿擾模式」是否關閉

**測試震動**:
如果聲音不行，至少應該有震動反饋。

---

### 問題 6: 配速計算不準確

**症狀**: 配速跳動很大，或顯示不合理的值（如 1'00"/km）

**解決方案**:
1. GPS 信號問題 → 移動到空曠區域
2. 剛開始跑步時配速會不穩定（正常）
3. 檢查速度計算邏輯:
   ```swift
   if currentSpeed > 0 {
       currentPace = 1000.0 / currentSpeed  // 秒/公里
   }
   ```

---

## 📊 性能測試

### 電池消耗測試

**測試方法**:
1. 記錄訓練前電量（如 100%）
2. 進行 1 小時訓練
3. 記錄訓練後電量（如 85%）
4. 計算消耗: 15% / 小時

**預期消耗**:
- 正常訓練: 10-15% / 小時
- 如果 > 20% / 小時 → 需要優化

**優化建議**:
- 確保訓練結束後停止 GPS
- 避免不必要的數據採樣
- 減少 UI 更新頻率

---

### 響應速度測試

**測試項目**:
- [ ] App 啟動時間 < 2 秒
- [ ] 頁面切換延遲 < 0.5 秒
- [ ] 數字更新流暢（無卡頓）
- [ ] 按鈕響應即時

---

## ✅ 完整測試清單

複製此清單用於測試:

### 基礎功能
- [ ] App 成功安裝
- [ ] 課表同步成功
- [ ] 課表列表顯示正確
- [ ] 今天高亮顯示
- [ ] 下拉刷新有效

### 課表詳情
- [ ] 簡單訓練詳情完整
- [ ] 間歇訓練工作段/恢復段顯示
- [ ] 組合跑所有階段可見
- [ ] 「開始訓練」按鈕可點擊

### 訓練追蹤（輕鬆跑）
- [ ] 心率實時更新
- [ ] 心率區間判斷正確
- [ ] 心率區間延伸正確
- [ ] 距離累計正確
- [ ] 時間累計正確
- [ ] GPS 軌跡記錄

### 訓練追蹤（配速模式）
- [ ] 配速實時計算
- [ ] 配速區間顯示正確（慢左快右）
- [ ] 配速區間延伸正確
- [ ] 配速狀態提示正確

### 間歇訓練
- [ ] 工作段顯示正確
- [ ] 恢復段顯示正確
- [ ] 組數追蹤正確
- [ ] 5 秒倒數提示音
- [ ] 段落完成提示音
- [ ] 震動反饋正常
- [ ] 自動切換段落

### 組合跑
- [ ] 階段顯示正確
- [ ] 階段自動切換
- [ ] 下一段預覽顯示
- [ ] 提示音正常

### 訓練控制
- [ ] 暫停功能正常
- [ ] 繼續功能正常
- [ ] 結束確認對話框
- [ ] 數據保存到 HealthKit

### 數據驗證
- [ ] HealthKit 中有訓練記錄
- [ ] GPS 軌跡完整
- [ ] 心率數據存在
- [ ] iOS app 可讀取

---

## 📝 測試報告模板

測試完成後，可以使用此模板記錄結果:

```
## Paceriz Watch App 測試報告

測試日期: 2025-11-17
測試設備: Apple Watch Series 8 (45mm)
watchOS 版本: 10.0
測試時長: 30 分鐘

### 測試結果總結
- 通過: 45/50
- 失敗: 3/50
- 未測試: 2/50

### 發現的問題
1. 問題描述
   - 重現步驟
   - 預期行為
   - 實際行為
   - 嚴重程度

### 建議改進
1. ...
2. ...
```

---

需要我幫你準備任何特定的測試場景嗎？或者有其他測試相關的問題？