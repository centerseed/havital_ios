# Paceriz Apple Watch App - 設計提案

## 📱 目錄
1. [UI 設計方案](#ui-設計方案)
2. [功能優先級](#功能優先級)
3. [技術架構選擇](#技術架構選擇)
4. [用戶體驗流程](#用戶體驗流程)
5. [待討論問題](#待討論問題)

---

## 1. UI 設計方案

### 🎨 配色系統

基於現有 app icon 的配色（藍色跑鞋圖標）：

**主色調**：
- Primary Blue: `#1E90FF` (Dodger Blue) - 主要按鈕、標題
- Secondary Blue: `#00BFFF` (Deep Sky Blue) - 輔助元素
- Background: `#1C1C1E` (Dark Gray) - 深色背景
- Surface: `#2C2C2E` (Medium Gray) - 卡片背景

**訓練類型色彩映射**（與 iOS app 一致）：
- 綠色：輕鬆跑、恢復跑、LSD、瑜伽
- 橙色：間歇、節奏、閾值、漸進、組合
- 藍色：長距離、登山、騎行
- 紅色：比賽
- 灰色：休息
- 紫色：交叉訓練、力量訓練

**心率區間顏色**：
- Z1 輕鬆：綠色 `#4CAF50`
- Z2 馬拉松：藍色 `#2196F3`
- Z3 閾值：黃色 `#FFC107`
- Z4 有氧：橙色 `#FF9800`
- Z5 無氧/間歇：紅色 `#F44336`

---

### 📐 頁面結構設計

#### **頁面 1: 課表列表 (Weekly Schedule View)**

```
┌─────────────────────┐
│  本週課表  第 3/12 週  │
├─────────────────────┤
│ 今天 11/17          │
│ 🟢 輕鬆跑           │
│ 8.0 km | 5'30"/km  │
├─────────────────────┤
│ 明天 11/18          │
│ 🟠 間歇跑           │
│ 6.0 km | 4'15"/km  │
├─────────────────────┤
│ 11/19              │
│ 🔵 長距離跑         │
│ 15.0 km | 5'45"/km │
└─────────────────────┘
```

**設計重點**：
- 使用 `List` 或 `ScrollView` + `LazyVStack`
- 今天的課表置頂並高亮顯示
- 顏色圓點快速識別訓練類型
- 顯示距離和目標配速（如果有）
- 點擊進入詳情頁

**互動方式**：
- 向下滾動：查看未來課表
- 點擊：進入課表詳情
- Digital Crown：快速滾動

---

#### **頁面 2: 課表詳情 (Workout Detail View)**

**方案 A：緊湊版（推薦）**
```
┌─────────────────────┐
│  🟢 輕鬆跑           │
│  今天 11/17         │
├─────────────────────┤
│ 目標                │
│ 📏 8.0 km          │
│ ⏱ 44 分鐘          │
│ 💓 120-145 bpm     │
├─────────────────────┤
│ 訓練說明            │
│ 保持輕鬆配速，      │
│ 感覺舒適為主        │
├─────────────────────┤
│  [ 開始訓練 ]       │
└─────────────────────┘
```

**方案 B：卡片版**
```
┌─────────────────────┐
│  🟢 輕鬆跑           │
├─────────────────────┤
│ ╔═════════════════╗ │
│ ║  8.0 km        ║ │
│ ║  44 分鐘        ║ │
│ ╚═════════════════╝ │
├─────────────────────┤
│ 心率區間            │
│ 💓 120-145 bpm     │
│ (Z1 輕鬆區間)       │
├─────────────────────┤
│  [ 開始訓練 ]       │
└─────────────────────┘
```

**設計重點**：
- 清晰顯示訓練目標（距離、時間、心率/配速）
- 對於間歇訓練，顯示重複次數和工作/恢復段
- 大按鈕「開始訓練」，方便點擊
- 顯示訓練說明/提示（如果有）

**特殊訓練類型處理**：

*間歇跑示例*：
```
┌─────────────────────┐
│  🟠 間歇跑           │
├─────────────────────┤
│ 6 組 × 1000m       │
│ 工作: 4'00"/km     │
│ 恢復: 400m 慢跑     │
├─────────────────────┤
│ 總距離: 9.0 km     │
│  [ 開始訓練 ]       │
└─────────────────────┘
```

---

#### **頁面 3: 訓練中 (Active Workout View)**

**3A. 輕鬆課表（心率追蹤模式）**
```
┌─────────────────────┐
│     輕鬆跑           │
├─────────────────────┤
│                     │
│       142          │
│      ━━━━━         │
│     當前心率         │
│                     │
├─────────────────────┤
│  Z1 輕鬆區間  🟢    │
│  目標 120-145 bpm   │
├─────────────────────┤
│ 3.2 km  │  17'32"  │
│ 5'28"/km │ 142 bpm │
└─────────────────────┘
```

**心率區間指示器設計**：
```
當前心率: 142 bpm

┌─────────────────────┐
│ Z1  Z2  Z3  Z4  Z5  │
│ 🟢  ⚪  ⚪  ⚪  ⚪  │
│ 你現在在輕鬆區間     │
└─────────────────────┘

或者使用進度條：
┌─────────────────────┐
│ 120 ━━━━━●━━━ 145   │
│    Z1 輕鬆區間       │
└─────────────────────┘
```

**3B. 非輕鬆課表（配速追蹤模式）**
```
┌─────────────────────┐
│     間歇跑           │
├─────────────────────┤
│                     │
│      4'12"         │
│      ━━━━━         │
│     當前配速         │
│                     │
├─────────────────────┤
│  目標 4'00"/km      │
│  區間 3'40"-4'20"   │
├─────────────────────┤
│ 第 2/6 組           │
│ 0.82 km  │  3'28"  │
└─────────────────────┘
```

**配速區間指示器**：
```
當前配速: 4'12"/km
目標配速: 4'00"/km (±20秒)

┌─────────────────────┐
│ 3'40" ━━━━●━━━ 4'20" │
│      配速區間        │
│   ✅ 在目標內        │
└─────────────────────┘

太快時：
┌─────────────────────┐
│ 3'40" ━━●━━━━━ 4'20" │
│      配速區間        │
│   ⚠️ 配速過快        │
└─────────────────────┘
```

**設計重點**：
- 大字體顯示最重要的指標（心率或配速）
- 清晰的視覺反饋（顏色變化、圖標）
- 實時更新，流暢動畫
- 支持點擊暫停/結束
- 顯示累計數據（距離、時間）

**互動方式**：
- Digital Crown：滾動查看更多指標
- 點擊螢幕：暫停/繼續
- 向左滑動：結束訓練

---

#### **頁面 4: 訓練完成 (Workout Summary View)**

```
┌─────────────────────┐
│  ✅ 訓練完成         │
├─────────────────────┤
│     輕鬆跑           │
│                     │
│  8.2 km             │
│  45'32"             │
├─────────────────────┤
│ 平均配速 5'33"/km   │
│ 平均心率 138 bpm    │
│ 卡路里  520 kcal    │
├─────────────────────┤
│  [ 完成 ]           │
└─────────────────────┘
```

**設計重點**：
- 簡潔的總結資訊
- 自動保存到 HealthKit
- 點擊「完成」返回課表列表

---

### 📏 尺寸和字體規範

**Apple Watch 尺寸考量**：
- 40mm: 324 × 394 pixels
- 41mm: 352 × 430 pixels
- 44mm: 368 × 448 pixels
- 45mm: 396 × 484 pixels
- 49mm: 410 × 502 pixels

**字體大小建議**：
- 訓練中主要數字（心率/配速）: `.system(size: 52, weight: .bold)`
- 頁面標題: `.title3` (20pt)
- 次要信息: `.body` (17pt)
- 小字說明: `.caption` (12pt)

**觸控目標**：
- 按鈕最小尺寸: 44 × 44 pt
- 列表項目高度: 60-80 pt

---

## 2. 功能優先級

### 🎯 MVP (最小可行產品) - Phase 1

**核心功能**（必須實現）：
1. ✅ 查看本週課表列表
2. ✅ 查看單日課表詳情
3. ✅ 開始訓練（基礎版）
4. ✅ 訓練中實時顯示：
   - 輕鬆課表：顯示當前心率 + 目標心率區間
   - 非輕鬆課表：顯示當前配速 + 目標配速區間（±20秒）
5. ✅ 訓練完成後保存到 HealthKit
6. ✅ iOS app 同步課表到 Apple Watch

**數據需求**：
- 訓練類型
- 目標距離
- 目標配速/心率範圍
- 當前心率（實時）
- 當前配速（實時）
- GPS 軌跡

**技術實現**：
- WatchConnectivity（iOS ↔ watchOS）
- HealthKit WorkoutSession
- CoreLocation（GPS）
- 本地存儲（App Group）

---

### 🚀 Phase 2 - 進階功能

**優先級排序**：

**高優先級**：
1. 心率區間智能判斷
   - 自動識別當前在 Z1-Z5 哪個區間
   - 視覺化心率區間分布（進度條）

2. 配速區間視覺反饋
   - 配速過快/過慢時的顏色提示
   - 震動反饋（可選）

3. 間歇訓練支持
   - 自動計算組數
   - 工作段/恢復段提醒
   - 組間休息計時

4. 訓練提醒和通知
   - 訓練日推送通知
   - 長時間未訓練提醒

**中優先級**：
5. 歷史訓練記錄查看
   - 在 Watch 上查看最近 7 天訓練
   - 簡單的統計數據

6. 語音播報（可選）
   - 每公里播報配速/心率
   - 進入/離開目標區間時提醒

7. 離線支持
   - 無網路時也能開始訓練
   - 本地緩存 2 週課表

**低優先級**：
8. 複雜訓練類型
   - 漸進跑（分段配速變化）
   - 組合跑（多種訓練混合）

9. 自定義訓練目標調整
   - 在 Watch 上修改目標配速
   - 臨時調整訓練距離

10. 社交功能
    - 訓練完成分享
    - 成就解鎖

---

### 🔍 功能範圍界定

**包含的功能**：
- ✅ 跑步訓練（主要）
- ✅ 心率監控
- ✅ GPS 追蹤
- ✅ 基礎訓練統計

**不包含的功能**（至少在 MVP）：
- ❌ 音樂控制
- ❌ 地圖顯示（Apple Watch 屏幕太小）
- ❌ 詳細的心率變異性分析
- ❌ 訓練計劃生成（仍在 iOS app 完成）
- ❌ 社交功能（點讚、評論等）

---

## 3. 技術架構選擇

### 🏗️ 架構方案對比

#### **方案 A：Watch Connectivity + App Group（推薦）**

**數據流**：
```
iOS App
  ↓ WatchConnectivity (實時)
  ↓ App Group (離線緩存)
watchOS App
  ↓ HealthKit
Apple Health
  ↑ 自動同步
iOS App (讀取並上傳到後端)
```

**優點**：
- ✅ 實時同步（iOS app 打開時）
- ✅ 離線支持（App Group 共享存儲）
- ✅ 實現簡單
- ✅ Apple 推薦方式

**缺點**：
- ❌ 需要 iOS app 至少啟動一次同步課表
- ❌ 首次配對需要手動觸發同步

---

#### **方案 B：watchOS 獨立網路請求**

**數據流**：
```
watchOS App
  ↓ URLSession (直接請求後端 API)
Paceriz Backend
  ↓ 返回課表
watchOS App
```

**優點**：
- ✅ 完全獨立運行
- ✅ 不依賴 iPhone

**缺點**：
- ❌ 需要實現完整的認證流程
- ❌ 增加複雜度
- ❌ 電池消耗較高
- ❌ 需要處理 Token 過期問題

---

**推薦方案**：**方案 A（Watch Connectivity + App Group）**

**理由**：
1. 大部分用戶跑步時會帶 iPhone
2. 實現簡單，電池友好
3. 符合 Apple 生態系統設計
4. 可以在 Phase 2 再考慮獨立網路支持

---

### 🔄 數據同步策略

#### **同步時機**：
1. **iOS app 啟動時** - 自動同步本週課表到 Watch
2. **課表更新時** - 用戶生成新週計劃後自動推送
3. **手動刷新** - Watch app 中下拉刷新（如果 iPhone 在附近）
4. **背景同步** - iOS app 在背景時定期同步（可選）

#### **同步內容**：
- 當週課表（7天）
- 下週課表（預加載，可選）
- 用戶基本信息（MaxHR, RestingHR, VDOT）
- 心率區間配置

#### **衝突處理**：
- iOS app 為數據源（Single Source of Truth）
- Watch 只讀課表，不修改
- 訓練記錄先保存到 HealthKit，再由 iOS app 上傳

---

### 💾 本地存儲方案

**使用 App Group**：
```swift
let sharedDefaults = UserDefaults(suiteName: "group.com.havital.paceriz")

// 存儲結構
{
  "weeklyPlan": { ... },           // 當週課表
  "userProfile": {
    "maxHR": 190,
    "restingHR": 55,
    "vdot": 48.5
  },
  "heartRateZones": [ ... ],       // 心率區間
  "lastSyncTime": "2025-11-17T10:30:00Z"
}
```

**存儲容量考量**：
- 單週課表約 10-20 KB
- 2 週課表 + 配置約 50 KB
- App Group 限制 500 MB（綽綽有餘）

---

### ⚡ 電池優化策略

1. **GPS 精度**：
   - 使用 `desiredAccuracy = kCLLocationAccuracyBest` 訓練中
   - 非訓練時關閉 GPS

2. **心率採樣**：
   - 訓練中：每秒採樣
   - 非訓練時：不採樣

3. **螢幕亮度**：
   - 使用系統預設（用戶可在設置中調整）
   - 支持 Always-On Display

4. **網路請求**：
   - 訓練中不進行網路請求
   - 僅在 iOS app 可用時同步

---

## 4. 用戶體驗流程

### 🎬 首次使用流程

```
1. 用戶在 iPhone 上打開 Paceriz
   ↓
2. 系統自動檢測 Apple Watch
   ↓
3. 提示安裝 Watch app
   ↓
4. 自動同步當週課表
   ↓
5. 在 Watch 上打開 app
   ↓
6. 顯示課表列表
```

**需要的引導**：
- 首次啟動時說明如何使用
- 簡單的 3 步教程（可跳過）

---

### 🏃 日常使用流程

**場景 1：查看課表**
```
打開 Watch app → 看到本週課表 → 點擊今天的訓練 → 查看詳情
```

**場景 2：開始訓練**
```
打開 Watch app → 點擊今天的訓練 → 點擊「開始訓練」
→ 訓練中實時監控 → 結束訓練 → 查看總結 → 自動保存
```

**場景 3：臨時訓練（沒有課表）**
```
打開 Watch app → 「今天沒有課表」 → 「自由訓練」按鈕
→ 選擇訓練類型 → 開始訓練
```

---

### 🚨 邊緣案例處理

**情況 1：沒有網路/iPhone 不在附近**
- 顯示最後同步的課表
- 顯示「離線模式」標識
- 允許開始訓練（數據本地保存）
- 訓練記錄暫存，等待同步

**情況 2：GPS 信號弱**
- 顯示警告「GPS 信號弱」
- 繼續訓練（使用加速度計估算）
- 提示用戶移動到空曠區域

**情況 3：未配置心率區間**
- 使用預設區間（基於年齡估算）
- 提示在 iOS app 中設置準確的 MaxHR/RestingHR

**情況 4：訓練中斷（電話、緊急情況）**
- 自動暫停訓練
- 保存已完成的部分
- 允許稍後繼續或結束

**情況 5：課表未同步**
- 顯示「需要同步」
- 提供「在 iPhone 上打開 app」提示
- 或提供「自由訓練」選項

---

## 5. 待討論問題

### 🤔 需要你決定的事項

#### **問題 1：訓練中頁面的指標顯示**

你希望一屏顯示所有信息，還是分頁顯示？

**選項 A：單頁所有信息（緊湊）**
```
┌─────────────────────┐
│     142 bpm         │  ← 主要指標
│  Z1 輕鬆區間  🟢     │
├─────────────────────┤
│ 3.2km │ 17'32" │5'28"│  ← 次要指標
└─────────────────────┘
```

**選項 B：分頁顯示（清晰）**
```
頁面 1：心率/配速
┌─────────────────────┐
│     142 bpm         │
│  Z1 輕鬆區間  🟢     │
└─────────────────────┘

頁面 2：距離和時間
┌─────────────────────┐
│    3.2 km           │
│    17'32"           │
└─────────────────────┘

頁面 3：配速和卡路里
┌─────────────────────┐
│   5'28"/km          │
│   256 kcal          │
└─────────────────────┘
```

**我的建議**：選項 A（單頁），因為跑步時頻繁滑動螢幕不方便。

---

#### **問題 2：配速區間的寬度**

你提到「目標配速 ± 20 秒」，這適用於所有配速嗎？

**示例**：
- 目標 5'00"/km → 區間 4'40" - 5'20"/km（可接受）
- 目標 4'00"/km → 區間 3'40" - 4'20"/km（可能太寬）
- 目標 6'30"/km → 區間 6'10" - 6'50"/km（可能太窄）

**建議方案**：
- 快速配速（< 4'30"/km）: ± 15 秒
- 中等配速（4'30" - 6'00"/km）: ± 20 秒
- 慢速配速（> 6'00"/km）: ± 25 秒

或者使用**百分比**：± 7% 的配速差異

你的偏好？

---

#### **問題 3：間歇訓練的自動識別**

對於間歇訓練，是否需要自動檢測組數？

**方案 A：手動標記（簡單）**
- 用戶手動點擊「下一組」
- 準確但需要操作

**方案 B：自動檢測（智能）**
- 根據配速/心率變化自動識別
- 無需操作但可能不準確

**方案 C：混合模式（推薦）**
- 預設自動檢測
- 允許手動調整
- 震動提醒「檢測到新組」

你的偏好？

---

#### **問題 4：訓練類型的優先級**

在 MVP 階段，你希望支持哪些訓練類型？

**全部 14 種類型** vs **精簡到跑步相關**？

**建議精簡（MVP）**：
- ✅ 輕鬆跑、恢復跑、LSD
- ✅ 間歇跑、節奏跑、閾值跑
- ✅ 長距離跑
- ✅ 休息日（顯示「今天休息」）
- ❌ 力量、瑜伽、騎行（Phase 2）

這樣可以更快完成核心功能。同意嗎？

---

#### **問題 5：心率區間的命名**

在小螢幕上，區間名稱需要簡潔：

**選項 A：完整名稱**
- Z1 輕鬆區間
- Z2 馬拉松區間
- Z3 閾值區間
- Z4 有氧區間
- Z5 無氧區間

**選項 B：簡短名稱**
- Z1 輕鬆
- Z2 馬拉松
- Z3 閾值
- Z4 有氧
- Z5 無氧

**選項 C：英文縮寫**
- Z1 Easy
- Z2 Marathon
- Z3 Threshold
- Z4 Aerobic
- Z5 Interval

你的偏好？（我推薦 B）

---

#### **問題 6：訓練完成後的行為**

訓練結束後，應該：

**選項 A：自動保存並返回列表**
- 顯示 2 秒總結
- 自動返回課表列表

**選項 B：停留在總結頁**
- 顯示詳細總結
- 用戶手動點擊「完成」

**選項 C：混合**
- 短訓練（< 30 分鐘）：自動返回
- 長訓練（≥ 30 分鐘）：停留總結頁

你的偏好？

---

#### **問題 7：同步策略**

你希望課表同步是：

**選項 A：自動靜默同步**
- iOS app 啟動時自動同步
- Watch app 啟動時檢查更新
- 用戶無感知

**選項 B：手動同步**
- Watch app 中提供「同步」按鈕
- 用戶主動觸發
- 更可控

**選項 C：混合（推薦）**
- 預設自動同步
- 提供手動刷新選項（下拉）
- 顯示最後同步時間

你的偏好？

---

### 📝 其他設計考量

#### **無障礙功能**
- VoiceOver 支持
- 大字體模式
- 高對比度模式

是否在 MVP 考慮？還是 Phase 2？

#### **多語言支持**
現有 iOS app 支持哪些語言？Watch app 需要同步嗎？

#### **Apple Watch 型號兼容性**
- 最低支持 watchOS 版本？（建議 watchOS 9.0+）
- 是否支持舊款 Watch（如 Series 4）？

---

## 📊 開發時間估算

基於上述設計，預估開發時間：

### Phase 1 (MVP)
- 數據模型和同步邏輯：2-3 天
- 課表列表頁：1 天
- 課表詳情頁：1 天
- 訓練中頁面：3-4 天（最複雜）
- HealthKit 集成：2 天
- iOS WatchConnectivity：1 天
- 測試和調試：2-3 天

**總計：12-15 天**

### Phase 2（進階功能）
- 間歇訓練自動檢測：2-3 天
- 語音播報：1-2 天
- 離線優化：1 天
- 歷史記錄查看：2 天
- UI 優化和動畫：2 天

**總計：8-10 天**

---

## ✅ 下一步行動

請你回覆以下問題，我就可以開始實施：

1. ✅ UI 設計方案確認（特別是訓練中頁面）
2. ✅ 功能優先級確認（是否同意 MVP 範圍）
3. ✅ 待討論問題的決定（問題 1-7）
4. 🤔 是否有其他需求或調整？

確認後，我會立即開始編寫代碼！🚀
